# NewSQL徹底入門 - Forkwell Library #119
- [https://forkwell.connpass.com/event/382291/](https://forkwell.connpass.com/event/382291/)
- 参加日：2026年2月5日（木）
- 19:30～21:00
- 参加形態：個人参加（プライベート）
- オンライン
- ハッシュタグ：#Forkwell_Library
# 目次
- 19:30	オープニング（5分）	
- 19:35	講演①（25分）「NewSQLユースケース7選」	ミック 氏
- 20:00	講演②（25分）「NewSQLのアーキテクチャ - RDBの進化 -」	小林 隆浩 氏
- 20:25	Forkwell LT（5分）	Forkwell 運営
- 20:30	視聴者Q&Aセッション（25分）	ミック氏・小林 隆浩 氏
- 20:55	クロージング（5分）	
# 「NewSQLユースケース7選」	ミック 氏
- 昔、データベースをやっていた人
  - 今は、技術戦略を考える人
  - アメリカで働いた事ある人
- NewSQLの登場は、あるアナリストが使用したのがきっかけ
  - 高いパフォーマンスとスケーラビリティを提供するシステム
  - RDBの泣き所であった水平スケーリングが得意
  - 名前に反して、NewSQLに新しい機能は無い
  - RDBの長所を残しつつ、スケーラビリティと信頼性を高める
- 2017年に代表的な製品が多く出た
- NewSQL
  - Cloud spanner
    - PostgreSQLと互換
    - Google
  - yugabyteDB
    - PostgreSQLと互換
  - TiDB（タイディビー）
    - 日本で一番導入事例が多い
    - MySQLと互換
  - CockroachDB
    - PostgreSQLと互換
    - 日本法人無し＆代理店も無し
- ビックベンダーも参入してきている：AWS・oracle
- ユースケース
  - 高負荷のリテールEC
    - DoorDash：ウーバーイーツのライバル
      - 更新負荷に対してスケールさせる
      - 120万QPSのスループットを実現
      - 大量の在庫の更新情報を一度CockroachDBで永続化し、CDCで後続のKafkaに流している
    - Flipkart
      - TiDBに移行
  - 高可用性
    - 金融分野における高可用性
      - みんなの銀行
        - Cloud Spanner
        - 東阪両現用
      - Form3
        - 規制当局から「もしAWSが利用不可能となったらどうするのか？」という指摘に対応する必要があった
        - EUでマルチクラウド構成が人気
  - 増えすぎたデータベースの統合
    - レバテック
      - マイクロサービスはトランザクション制御が難しい
      - あまり海外では見ない事例
  - 異種混合データベースの統合
    - DMM.com
      - 3種類のDBに精通しているエンジニアは少ないため習熟のハードルが高かった
  - 地理的分散
    - Netflix
      - データベースにリージョンを跨いでいる事が要件
      - ユーザーに地理的に近いから、速度がある＆可用性
- マルチクラウド
  - 規制当局がレギュレーションで規制してくるかがカギになる
  - 民間に任せると来ない（コスト増大になるから）
- TCOを減らして、スモールスタートができるようになるかが今後の普及のカギ
# 「NewSQLのアーキテクチャ - RDBの進化 -」	小林 隆浩 氏
- 普段はPostgreSQLを仕事にしている
  - でも色んなの触るの好きで本書いてる
- １：単一インスタンスの説明
- ２：レプリケーションの説明
- ３：双方向レプリケーションによるマルチプライマリの説明
- ４：マネージドシャーディングの説明
  - テーブルをシャードして配分
- 可用性・レイテンシー・読み取りスケールアウト・書き取りスケールアウト比較
- ５：ログ適用可能なストレージを用いたDB
  - AWSのAurora・GoogleのAlloyDB
- ６：分散ストレージ（エンジン）＋SQL
- ストレージエンジンって何？
  - 物理的にデータを格納する役割を持つ
  - SQLを処理するクエリエンジンとやり取りして、ファイルシステム等へ読み書きを行う
  - 従来、RDBが利用するB-Treeと、NewSQLで使われるLSM-Treeがある
  - 読み取り/書き込み/容量で評価される
- LSM-Treeの実装：RocksDB
  - TiDBでも使用されている
- シャーディング
  - レンジ・シャーディング
    - 人間に分かる区切り方
  - ハッシュ・シャーディング
    - 均等分散する
- インターリーブ
  - 親と子テーブルを一緒のシャーディングに入れるために使用
- Raft
  - 可用性を高めるために使用
  - シャーディングに分けたシャードをRaft（合意プロトコル）
  - Leader選出
    - RaftはLeaderの役割が大きく、レプリケーションや読み取りもLeaderが主導する
    - 3台あれば、1台障害が起こっても大丈夫
- 感想：Raftは難しく図も多いので、プレゼン資料を見よう
# 視聴者Q&Aセッション（25分）	ミック氏・小林 隆浩 氏
- Spannerの最小構成が意外と安いそうですが、費用以外に社内に請求できそうな要素は？
  - ビッククエリと合わせやすい
  - Google　cloudの機能を使うときはやりやすい（外は、あまり）
  - 普通に使うと、最小構成で収まらないと思うので、各自で利用量は確認した方が良い
- 導入前に考える要件
  - レイテンシーとスループットのバランス
    - 基本は、NewSQLを使用すると遅くなる
  - コスト
  - トランザクションの分離レベルが既存と合わせられない時がある
  - 似せようとしているがSQLの挙動がたまに違う事がある
- なぜ、CockroachDBは日本に来ないと思いますか？
  - ライセンスをガチガチに固めているから国際展開に向いていない
  - 地理的分散を押しているので、アメリカくらい広くないと意味がないかも
  - 結構大手で、実績もある
  - ロゴがゴキブリなせいではないと思う
  - NewSQLは、どこも販社が取り扱いしてなくて、直接乗り込んできているから、販社は無いのが普通
