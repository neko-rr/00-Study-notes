# 「支援」を止めない技術。虎ラボ | CAMPFIRE 開発の裏側をLT会！
- [https://connpass.com/event/361430/](https://connpass.com/event/361430/)
- 参加日：2025年12月5日（金）
- 19:00～21:00
- 参加形態：個人参加（プライベート）
- 対面
- 開催場所：大阪
- #開発の裏側LT会
# 参加目次
- 19:30	1枠目（虎ラボ：1700万人の使うシステムの心臓部を止めずに仕様変更をする）
- 19:45	2枠目（CAMPFIRE：ゲスト支援における認証状態管理で気を付けたこと）
- 20:00	3枠目（CAMPFIRE：フロントエンド分離、絶対に失敗できない現場から）
- 20:25	4枠目（虎ラボ：ジョブキューイングシステムの移行）
- 20:40	5枠目（CAMPFIRE：CAMPFIREが目指す社内のAI活用を育てていく仕組み）
- 20:55	6枠目（虎ラボ：FantiaチームへのAI導入のリアル）
# 企業紹介
## 日本コムシンク㈱
- 40周年
- コンサルティングやシステム開発、DX推進
- 教育は、ITとコンサルの両方を行っている
- 金融系企業に強い
- オフィスは、綺麗で小さ目
## 虎の穴ラボ
- 皆知っている「とらのあな」
- 勤務体系を分けるために分社化しました
  - フレックスタイム制・フルリモート体制
- キャラは、採用HPから手に入りますよー
- 社内勉強会・コラボ勉強会を沢山しています
- 全員、Mac
## CAMPFIRE
- クラウドファンティングの説明
- 累計流通金額1,030億円・累計プロジェクト10.8万件・530万人登録者
- 国内最大：48％
- 全員、Mac
# LT
# 虎ラボ：1700万人の使うシステムの心臓部を止めずに仕様変更をする
- 好きな作品は、無職転生～
- Fantia：1700万人
- 技術
  -　React・・
- 「一度退会しても、戻ってきたら以前の閲覧権限を引き継いでほしい」
  - 当時は、Geminiがバージョン1だったりした。
  - データ量がめっちゃ多い
- 1:「テーブル更新じゃダメ？」
  - A：DBがお亡くなりになります
    - 権限が月毎プラン毎
    - 9年間の歴史
    - 基本、サービス無停止で提供している
  - 2:「テーブル構成を変更したらダメ？」
    - できません⇒メンテナンスしたくないです。
- 3:「オンラインDBではダメなの？」
  - データが多すぎて危険です
- 解決
  - リファクタの諦め
  - 修正箇所の局所化
    - サービスを良く知るエキスパートに相談して、判定の肝を相談した
  - 徹底的なテスト
    - 単体テストを順次追加しながら、泥臭く頑張った
    - 人力で確認した
- 教訓
  - あえて「戦わない」ことにも勇気がいる
- Q&A：全体でどれくらい時間かかった？
  - 絶対やるぞと決めてから3ヶ月くらい
  - 絶対やるぞと決める前は、もっとあった（別の人が）
- Q：リファクタを諦めたのは、何処？
  - 月xプランを表したかったが、諦めた
# CAMPFIRE：ゲスト支援における認証状態管理で気を付けたこと
- ガチアクタにハマっています
- Ruby on Railsをメインで採用している
- 「支援を決めた時が一番熱意があり」⇒会員登録が進む毎に離脱していく
  - 未ログインで、支援を可能にした
  - iPhone/Safariのみで利用可能(´;ω;｀)
  - 「限定」とは言え、公開URLのため、メールアドレスなどの個人情報はマスクしている
- 気を付けたこと
  - 個人情報管理
    - リーガルチェックもお願いした
    - 最初から、法務に相談していて、待ち時間で要件詰めていった
  - Apple Payは事前のメール送達が担保されない事から、
  - 排他的に認証情報を引けるようにした（カレントユーザーとゲストトークン）
    - ゲスト認証状態とログイン認証状態の排他制御を行う
# CAMPFIRE：フロントエンド分離、絶対に失敗できない現場から
- 複雑なロジックが混在するように
- 複数サービスの共存
- Ruby on RailsからフロントエンドSvelteを分離するように
- すでに分離済みのページ
- 失敗した場合の影響
  - 2桁万人以上/日
  - 4桁万円以上/日
- PJ詳細ページ：立ちはだかった壁
  - パターンの多さ【最大の壁】
    - ブランド毎のパターンxプロジェクトの状態
  - 仕様の把握
    - 入社2年以内ばかりのため、都度古参（PdM・デザイナー）に確認して、鵜呑みにせずに意図を理解するようにした
  - API項目の肥大化
  - ABテストの整理
  - SEO対応
- 負荷試験
  - 1回目は考慮漏れして、
- 副産物：Admin管理画面の改善
- PJ決済ページの3つの大きな変更
  - 決済パラメータの型定義（Ｉ/Ｆ）作成
- FE側の改善成果
  - 開発体験の向上
  - 使用の明確化
  - ユーザー体験の改善（支払方法による個数制限が解消：過去は必要だったが、今はそれ必要ない事を見つけた）
- BE側の改善成果
  - （Ｉ/Ｆ）作成
  - パフォーマンスの改善
    - PJ詳細ページ：約1.5倍～2倍
- Q&A：UIが膨大・どうやって整理した
  - デザイナーがFigmaやエンジニアがNotion
# 虎ラボ：ジョブキューイングシステムの移行
- Vチューバーが好き
- Fantia開発
- Javaが長い
- Ruby on Rails2年目
- Fantia
  - 2016年からDelayed::Jobを採用
    - ジョブ管理に既存のRDB
    - ジョブ取得処理によるDB負荷が課題
      - 20～30プロセスが1テーブルを更新していく
      - 軽量ジョブが大量に実行されるケースでは待ちが多くなる
    - 管理画面が無かった
    - Delayed::Job固有のnot～を使用していた
- 移行の背景
  - ジョブの利用状況1日平均数万件
  - 80％以上が画像／動画
  - 将来的な規模拡大に耐え
- Solid Queueを選んだ理由
  - 管理画面あり
  - リソースがRDBなのでDelayed::Jobから移行しやすい
    - また、戻すのも簡単で、一般的なRDBに変更できて、今の固有だから大変な要素が無くなる
- Sidekiq
  - 現在のスタンダード
  - 2万ジョブ/secの実績あり
  - 管理画面あり
  - かなり、高機能な特有機能あり（ジョブのバッチ実行・ワーカー単位のメトリクス取得・重複実行防止）など⇒無理に今必要ではない
- 安全に移行するための戦略
  - 段階的リリース
    - Active Jpb
    - 全てのジョブの重要度と実行頻度をランク付けして整理
      - 優先度Ａ：リスク低*頻度低
      - 優先度Ｂ：リスク中*高頻度（今回の主役の動画系・早く問題が無いか把握したかった）
        - 段階的に80％の負荷をかける
      - 優先度Ｃ：
  - リーリス後の監視
- 移行結果
  - リトライも画面上で可能になり簡単に
- 話者ポイント：事前調査・検証が何より大切
  - 現状分析：何時がホットタイムか等
  - つまずきを回避
- Q&A：平衡稼働時にジョブの重複実行対策は？
  - 裏で、切り替えていたので心配していなかった。
  - 切り替え瞬間も問題なく、選ばれた方で処理されていた
# CAMPFIRE：CAMPFIREが目指す社内のAI活用を育てていく仕組み
- 営業が使用しているスライドを食わせて、作成したのが今回のスライド
- Geminiで画像出力
- 昔、海外放浪していた？
- 現在の仕様状況
  - Cursor/Dwvin/GitHubCopilotを導入済み
  - 調査・設計から実装・レビューの各フェイズにおいてAIを活用
- 組織に合わせて、AIを育てていく
  - １：指針を作る：アーキテクチャレベルでの設計指針をルール化
    - 自社独自のを作るために「テックトーーク」を開催して、「暗黙知」⇒「形式知」にして指針を作る場
      - 「方針を決め打ち、必ず前に進める」という強い意志を持つこと
      - Rulesファイル
  - ２：コードレビュー
    - まだまだAIによる完璧なコードは作成できない
    - レビューコメントは「ルール化できていない組織の知見」と考える
      - これを蓄積すれば、次回はセルフチェックでチェックできるようになる
      - 自動収集・分析の仕組化
  - ３：開発指標を見える化をすでにやっていた
    - AIも複数ツールの利用状況を誰もが一箇所でモニタリングできるようにする
    - AIに分析させて、数字の羅列やグラフを「洞察」に変える試みをしている
      - デザインを決めていないので、毎週異なるデザインでレポートされている（自分：良い意味で、気にしてないのが良い）
      - 継続して「事実」に向き合う
  - ４：AIを使うのは「人」
    - 全社LT会（3ヶ月に1回）
      - エンジニア以外にも使っていこうという雰囲気を出している
      - エンジニアも非エンジニアと接する事で新しい視点を得る事ができる
      - 比率：弊社パートは半・半
    - AIハッカソンを1回開催
      - 実際に新規で作るのが一番理解できる
- Q&A：非エンジニアには、エンジニアが教えていくのみですか？
  - 基本的には各部署でGASを書いたりしていて、CEOがバリバリ使って推進している
# 虎ラボ：FantiaチームへのAI導入のリアル
- アイドルマスター好き
- Fantiaの開発
- 採用HPから「with AI」の採用ページに飛べる
- 自社使用
  - コーディングほぼ沢山：特に使用GitHub Copilot,Claude code
  - LLM：特に使用Gemini
- 利用場面：色々
  - コーディング
  - Devinを利用して仕様を与えて実装し、Pull Requestまでやらせる
- 隔週程度で各プロダクトのエンジニアが集まりAIに関するMTGをする
  - Devinを広める役目に
  - 導入目標：「1人月以上の成果を出させる」・「各プロジェクトの20％分をDevinで実行させる」
  - 利用率を高める（70％⇒2週間で90％）
    - ブラウザから直接セッション
    - Slackから呼び出す
  - 各人の知見を共有
  - 「Devinとは？」の勉強会を開催
- 効果測定
  - 主観しかないから、スプレッドシートを作成して記入してもらう
  - 急務になった事
    - 得意・不得意なタスクの仕分け
  - 時間が経つにつれて、スプレッドシートに書かなくなる（面倒）
- 効果測定の考え方を変えて、価値創出で考えようとした
  - 不具合とかをどれだけ直したか
- Devinの費用を1人工として、考えて導入した
- Q&A：AIのレビューが正しいかどうかの判断や質向上は、どうしているか？
  - 一つのAIだけでなく、複数AIに同時レビューさせて比較している
